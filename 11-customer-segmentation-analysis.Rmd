# 顧客區隔分析 {#customer-segmentation-analysis}

http://www.kimberlycoffey.com/blog/2016/8/k-means-clustering-for-customer-segmentation

https://www.ipsos.com/sites/default/files/ct/publication/documents/2018-01/n045_mkt_high_definition_customers_a_powerful_segmentation.pdf

顧客區隔分析(customer segmentation analysis)的目的是找到具有相同或相似屬性的顧客群，並將顧客群的特色樣貌及描繪出來，用來了解顧客的需求以及顧客如何在許多產品或服務中做出選擇。這些資訊能夠幫助公司找出最合適的目標市場，用最佳的行銷策略達到目標及該公司優於其他競爭者的地方。有效的顧客區隔研究可以定義出潛力看好的目標市場。

進行顧客區隔分析時，最常用來做為區隔根據的顧客特徵是：

- 地理區域 (居住地區、購買地區)
- 人口統計訊息 (例如年齡、性別、婚姻狀況、收入)
- 心理統計訊息 (例如價值觀、興趣、生活方式、隸屬團體)
- 購買行為 (例如以前的購買、瀏覽紀錄、運送偏好)

## 基於RFM三種資訊的顧客區隔分析
我選擇針對每個顧客的最近購買日期、購買頻率和貨幣價值來計算和使用指標。 這三個變量統稱為RFM，通常在出於市場營銷目的的客戶細分中使用。

載入套件
```{r}
library(tidyverse)
library(readxl)
```

讀取資料集檔案[線上零售資料集](https://archive.ics.uci.edu/ml/datasets/Online+Retail)

```{r}
Online_Retail <- read_excel("Online Retail.xlsx")
```

檢視資料集，這是一個發票的檔案，包含發票編號(InvoiceNo)、(StockCode)、描述(Description)、數量(Quantity)、發票日期(InvoiceDate)、單價(UnitPrice)、顧客識別號(CustomerID)、國別(Country)等變數欄位。
```{r}
summary(Online_Retail)
```

其中，顧客識別號(CustomerID)有許多NA(Not-Available)，先將這些資料去除，保留非NA的資料
```{r}
Online_Retail <- Online_Retail %>%
  filter(!is.na(CustomerID))
```

發票日期(InvoiceDate)在2010-12-01到2011-12-09間，稍微超過一年，為了方便計算起見，取2010-12-09到2011-12-09之間的資料
```{r}
Online_Retail <- Online_Retail %>%
  filter(InvoiceDate>="2010-12-09")
```

依據發票編號是否包含"C"，將發票紀錄區分為購買(purchase)或退貨(return)兩類
```{r}
Online_Retail <- Online_Retail %>%
  mutate(purchase.invoice=ifelse(grepl("C", InvoiceNo, fixed=TRUE), 0, 1))
```

# 計算每個顧客的最近購買日期(與2011-12-10的差)和購買頻率(一年的購買次數)
```{r}
customers <- Online_Retail %>%
  filter(purchase.invoice==1) %>% #只計算購買紀錄，去除退貨紀錄
  mutate(date.diff = as.numeric(as.Date("2011-12-10") - as.Date(InvoiceDate))) %>% #計算購買日期與2011-12-10差幾天
  group_by(CustomerID) %>% #依據CustomerID，將發票紀錄分組
  summarise(recency = min(date.diff),        #最近購買日期
            frequency=n_distinct(InvoiceNo)) #購買頻率(一年內購買幾次)
```

# 計算每個顧客的購買金額(減去退貨的情形)
```{r}
customers1 <- Online_Retail %>%
  group_by(CustomerID) %>%
  summarise(monetary=sum(UnitPrice*Quantity)) %>%
  filter(monetary>=0)
```

```{r}
customers <- customers %>%
  inner_join(customers1)
```

```{r}

```

